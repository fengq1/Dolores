<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="vue/vue.min.js"></script>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="element/index.css">
    <!-- 引入组件库 -->
    <script src="element/index.js"></script>
</head>
<body>
<div id="app">
    <el-row>
        <el-col :span="24">
            <el-tabs v-model="activeName" @tab-click="handleClick">
                <el-tab-pane label="任务视图" name="mission">任务视图</el-tab-pane>

                <!--SSH配置开始-->
                <el-tab-pane label="SSH配置" name="ssh">
                    <div v-show="sshSelectShow">
                        <el-row>
                            <el-col :span="3" :offset="18">
                                <el-button type="primary" @click="changeSshView" plain>新增</el-button>
                            </el-col>
                        </el-row>
                        <el-row style="padding-top:20px">
                            <el-col v-for="(ssh) in sshs" :key="ssh.name" :span="8" :offset="2"
                                    style="padding-top:10px;">
                                <el-card class="box-card" style="height: 250px">
                                    <div slot="header" class="clearfix">
                                        <span>配置：{{ssh.name}}</span>
                                        <el-button style="float: right;" type="danger"
                                                   icon="el-icon-delete" circle
                                                   @click="delSsh(ssh.id)">
                                        </el-button>
                                        <el-button style="float: right;" type="success"
                                                   icon="el-icon-s-promotion"
                                                   @click="testConnect(ssh.id)" circle></el-button>
                                    </div>
                                    <div v-if="ssh.jump">
                                        <div class="text item">
                                            堡垒机地址：{{ssh.jumpIp}}:{{ssh.jumpPort}}
                                        </div>
                                        <div class="text item">
                                            堡垒机用户名：{{ssh.jumpUsername}}
                                        </div>
                                        <div class="text item">
                                            堡垒机密码：{{ssh.jumpPassword}}
                                        </div>
                                    </div>
                                    <div class="text item">
                                        地址：{{ssh.ip}}:{{ssh.port}}
                                    </div>
                                    <div class="text item">
                                        用户名：{{ssh.username}}
                                    </div>
                                    <div class="text item">
                                        密码：{{ssh.password}}
                                    </div>
                                    <div class="text item">
                                        创建时间：{{ssh.createTime}}
                                    </div>
                                </el-card>
                            </el-col>
                        </el-row>
                    </div>
                    <div v-show="sshAddShow">
                        <el-row style="padding-top:20px">
                            <el-col :span="12" :offset="8">
                                新增SSH配置
                            </el-col>
                        </el-row>
                        <el-row style="padding-top:20px">
                            <el-col :span="12" :offset="3">
                                <el-form label-position="right" label-width="150px" :model="sshForm">
                                    <el-form-item label="名称">
                                        <el-input v-model="sshForm.name"></el-input>
                                    </el-form-item>
                                    <el-form-item label="是否堡垒机">
                                        <el-switch v-model="sshForm.jump" @change="jumpChange"></el-switch>
                                    </el-form-item>
                                    <el-form-item label="堡垒机ip" v-show="jumpShow">
                                        <el-input v-model="sshForm.jumpIp"></el-input>
                                    </el-form-item>
                                    <el-form-item label="堡垒机端口号" v-show="jumpShow">
                                        <el-input v-model="sshForm.jumpPort"></el-input>
                                    </el-form-item>
                                    <el-form-item label="堡垒机用户名" v-show="jumpShow">
                                        <el-input v-model="sshForm.jumpUsername"></el-input>
                                    </el-form-item>
                                    <el-form-item label="堡垒机密码" v-show="jumpShow">
                                        <el-input v-model="sshForm.jumpPassword"></el-input>
                                    </el-form-item>
                                    <el-form-item label="ip">
                                        <el-input v-model="sshForm.ip"></el-input>
                                    </el-form-item>
                                    <el-form-item label="端口号">
                                        <el-input v-model="sshForm.port"></el-input>
                                    </el-form-item>
                                    <el-form-item label="用户名">
                                        <el-input v-model="sshForm.username"></el-input>
                                    </el-form-item>
                                    <el-form-item label="密码">
                                        <el-input v-model="sshForm.password"></el-input>
                                    </el-form-item>
                                    <el-form-item>
                                        <el-button type="primary" @click="addSsh">提交</el-button>
                                        <el-button plain @click="changeSshView">返回</el-button>
                                    </el-form-item>
                                </el-form>
                            </el-col>
                        </el-row>
                    </div>
                </el-tab-pane>
                <!--应用配置开始-->
                <el-tab-pane label="项目配置" name="project">项目配置</el-tab-pane>
            </el-tabs>
        </el-col>
    </el-row>
</div>

<script>

    var jsConnector = {
        java_call: function (method, response) {
            alert("java_call");
            if (method === "reloadData") {
                alert("reloadData" + app.activeName);
                var data = JSON.parse(response);
                app.sshs = data.sshs;
                app.projects = data.projects;
            }
        }
    };

    function getJsConnector() {
        return jsConnector;
    };
    var app = new Vue({
        // 控制的标签容器
        el: '#app',
        // 交互的数据
        data: function () {
            return {
                activeName: 'ssh',
                sshs: [],
                projects: [],
                sshSelectShow: true,
                sshAddShow: false,
                jumpShow: false,
                sshForm: {
                    name: "",
                    ip: "",
                    port: "",
                    username: "",
                    password: "",
                    jump: false
                }
            }
        },
        // 方法
        methods: {
            handleClick(tab, event) {
                console.log(tab, event);
            },
            changeSshView() {
                this.sshSelectShow = !this.sshSelectShow;
                this.sshAddShow = !this.sshAddShow;
            },
            addSsh() {
                var result = JSON.parse(javaConnector.js_addSsh(JSON.stringify(this.sshForm)));
                if (result.success) {
                    this.successMsg();
                    this.changeSshView();
                } else {
                    this.errorMsg(result.msg);
                }
            },
            delSsh(id) {
                var result = JSON.parse(javaConnector.js_delSsh(id));
                if (result.success) {
                    this.successMsg(result.msg);
                } else {
                    this.errorMsg(result.msg);
                }
            },
            testConnect(id) {
                var result = JSON.parse(javaConnector.js_testConnect(id));
                if (result.success) {
                    this.successMsg(result.msg);
                } else {
                    this.errorMsg(result.msg);
                }
            },
            jumpChange() {
                this.jumpShow = this.sshForm.jump;
            },
            successMsg(msg) {
                this.$message({
                    message: msg,
                    type: 'success'
                });
            },
            errorMsg(msg) {
                this.$message.error(msg);
            }
        }
    });
</script>
</body>
</html>